{% extends 'index.html' %}
{% load static %}

{# åœ¨headä¸­æ·»åŠ ip_poolä¸“ç”¨çš„æ ·å¼ #}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/ip_poolstyle.css' %}">
{% endblock %}

{% block content %}
<div class="main-content">
    <!-- å·¦ä¾§å·¥ä½œå° -->
    <div class="sidebar">
        <h2>å·¥ä½œå°</h2>
        <div class="menu-list">
            <a href="{% url 'ip_pool' %}" class="menu-item {% if active_menu == 'ip_pool_overview' %}active{% endif %}">
                <span>IPæ± æ¦‚è§ˆ</span>
            </a>
            <a href="{% url 'ip_manage' %}" class="menu-item {% if active_menu == 'ip_manage' %}active{% endif %}">
                <span>IPç®¡ç†</span>
            </a>
            <a href="{% url 'proxy_settings' %}" class="menu-item {% if active_menu == 'proxy_settings' %}active{% endif %}">
                <span>ä»£ç†è®¾ç½®</span>
            </a>
            <a href="{% url 'monitoring' %}" class="menu-item {% if active_menu == 'monitoring' %}active{% endif %}">
                <span>ç›‘æ§ç»Ÿè®¡</span>
            </a>
            <a href="{% url 'operation_log' %}" class="menu-item {% if active_menu == 'operation_log' %}active{% endif %}">
                <span>æ“ä½œæ—¥å¿—</span>
            </a>
        </div>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
        <div class="content-header">
            <h2>{{ page_title|default:"IPæ± æ¦‚è§ˆ" }}</h2>
        </div>
        <div class="content-body">
            {% if active_menu == 'ip_pool_overview' %}
                <!-- IPæ± æ¦‚è§ˆå†…å®¹ -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>æ€»IPæ•°é‡</h3>
                        <p class="stat-number">{{ ip_stats.total }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>æ´»è·ƒIP</h3>
                        <p class="stat-number">{{ ip_stats.active }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>ä¸æ´»è·ƒIP</h3>
                        <p class="stat-number">{{ ip_stats.inactive }}</p>
                    </div>
                </div>
            {% elif active_menu == 'ip_manage' %}
                <!-- IPç®¡ç†è¡¨æ ¼ -->
                <div class="table-container">
                    <div class="table-actions">
                        <button class="btn btn-primary" onclick="runOneCrawl()">ç«‹å³é‡‡é›†ä¸€æ¬¡</button>
                        <button class="btn btn-primary" onclick="runOneScore()">ç«‹å³æ‰“åˆ†ä¸€æ¬¡</button>
                        <button class="btn btn-primary" onclick="openSettingsModal()">è®¾ç½®</button>
                        {% csrf_token %}
                        <div class="search-box">
                            <input type="text" placeholder="æœç´¢IP...">
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æœåŠ¡å™¨</th>
                                <th>å»¶è¿Ÿms</th>
                                <th>é€Ÿåº¦</th>
                                <th>ä¸Šä¼ æ—¶é—´1</th>
                                <th>ä¸Šä¼ æ—¶é—´2</th>
                                <th>ç±»å‹</th>
                                <th>å›½å®¶</th>
                                <th>SSL</th>
                                <th>CONN.</th>
                                <th>æœ€è¿‘å·¥ä½œæ—¶é—´</th>
                                <th>åˆ†æ•°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ip in ip_list %}
                            <tr>
                                <td>{{ ip.server }}</td>
                                <td>{{ ip.delay }}</td>
                                <td>{{ ip.speed }}</td>
                                <td>{{ ip.upload_time1 }}</td>
                                <td>{{ ip.upload_time2 }}</td>
                                <td>{{ ip.type }}</td>
                                <td>{{ ip.country }}</td>
                                <td>{{ ip.ssl }}</td>
                                <td>{{ ip.conn }}</td>
                                <td>{{ ip.last_work_time }}</td>
                                <td>{{ ip.score }}</td>
                                <td>
                                    <button class="btn-icon" title="ç¼–è¾‘">âœï¸</button>
                                    <button class="btn-icon" title="åˆ é™¤">ğŸ—‘ï¸</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="pagination">
                        {% if ip_list.has_previous %}
                            <a href="?page=1" class="page-link first-page">é¦–é¡µ</a>
                            <a href="?page={{ ip_list.previous_page_number }}" class="page-link">ä¸Šä¸€é¡µ</a>
                        {% endif %}

                        <div class="current-page">
                            ç¬¬ {{ ip_list.number }} é¡µ / å…± {{ ip_list.paginator.num_pages }} é¡µ
                        </div>

                        {% if ip_list.has_next %}
                            <a href="?page={{ ip_list.next_page_number }}" class="page-link">ä¸‹ä¸€é¡µ</a>
                            <a href="?page={{ ip_list.paginator.num_pages }}" class="page-link last-page">æœ«é¡µ</a>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- æ·»åŠ è®¾ç½®æ¨¡æ€æ¡† -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalLabel">ä»£ç†è®¾ç½®</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="crawler_interval" class="form-label">çˆ¬è™«é—´éš”ï¼ˆç§’ï¼‰</label>
                        <input type="number" class="form-control" id="crawler_interval" name="crawler_interval" min="60">
                    </div>
                    <div class="mb-3">
                        <label for="score_interval" class="form-label">è¯„åˆ†é—´éš”ï¼ˆç§’ï¼‰</label>
                        <input type="number" class="form-control" id="score_interval" name="score_interval" min="60">
                    </div>
                    <div class="mb-3">
                        <label for="min_score" class="form-label">æœ€ä½åˆ†æ•°ï¼ˆ0-100ï¼‰</label>
                        <input type="number" class="form-control" id="min_score" name="min_score" min="0" max="100">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                <button type="button" class="btn btn-primary" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'js/ip_pool.js' %}"></script>
{% endblock %}

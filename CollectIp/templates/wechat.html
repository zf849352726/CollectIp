{% extends 'index.html' %}
{% load static %}

{# åœ¨headä¸­æ·»åŠ wechatä¸“ç”¨çš„æ ·å¼ #}
{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/wechatstyle.css' %}">
<style>
/* å†…è”æ ·å¼ï¼Œç¡®ä¿åœ¨å¤–éƒ¨CSSåŠ è½½å¤±è´¥æ—¶ä»èƒ½æ˜¾ç¤ºåŸºæœ¬æ ·å¼ */
.main-content {
    margin-top: 60px;
    min-height: calc(100vh - 60px);
    display: flex;
}

.sidebar {
    width: 240px;
    background-color: white;
    border-right: 1px solid #e0e0e0;
    padding: 20px 0;
}

.sidebar h2 {
    padding: 0 20px;
    margin-bottom: 20px;
    color: #2c3e50;
}

.menu-list {
    display: flex;
    flex-direction: column;
}

.menu-item {
    padding: 12px 20px;
    color: #333;
    text-decoration: none;
    transition: all 0.3s;
}

.menu-item:hover {
    background-color: #f5f5f5;
    color: #3498db;
}

.menu-item.active {
    background-color: #f5f5f5;
    color: #3498db;
    border-right: 3px solid #3498db;
}

.content-area {
    flex: 1;
    padding: 20px;
    background-color: #f8f9fa;
    min-height: calc(100vh - 60px);
}

.content-header {
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #e9ecef;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.content-header h2 {
    font-size: 24px;
    color: #2c3e50;
    font-weight: 600;
}

.stats-cards {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background-color: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.stat-card h3 {
    font-size: 16px;
    color: #666;
    margin-bottom: 10px;
}

.stat-number {
    font-size: 32px;
    font-weight: 700;
    color: #3498db;
}

.table-container {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    padding: 20px;
    margin-bottom: 30px;
}

.table-actions {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}

.btn-primary {
    background-color: #3498db;
    color: white;
}

.collection-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
    width: 100%;
    margin: 0 auto;
}

.collection-card {
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    transition: all 0.4s;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.collection-cover {
    position: relative;
    height: 220px;
    overflow: hidden;
}

.collection-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s;
}

.collection-info {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th, 
.data-table td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid #f0f0f0;
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 10px;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
    .main-content {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .collection-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-cards {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="main-content">
    <!-- å·¦ä¾§å·¥ä½œå° -->
    <div class="sidebar">
        <h2>å·¥ä½œå°</h2>
        <div class="menu-list">
            <a href="{% url 'wechat_overview' %}" class="menu-item {% if active_menu == 'wechat_overview' %}active{% endif %}">
                <span>ç”µå½±åˆé›†</span>
            </a>
            <a href="{% url 'article_manage' %}" class="menu-item {% if active_menu == 'article_manage' %}active{% endif %}">
                <span>å‰§é›†åˆé›†</span>
            </a>
            <a href="{% url 'media_library' %}" class="menu-item {% if active_menu == 'media_library' %}active{% endif %}">
                <span>ç´ æåº“</span>
            </a>
            <a href="{% url 'data_analysis' %}" class="menu-item {% if active_menu == 'data_analysis' %}active{% endif %}">
                <span>æ•°æ®åˆ†æ</span>
            </a>
            <a href="javascript:void(0);" onclick="openSettingsModal()" class="menu-item {% if active_menu == 'wechat_settings' %}active{% endif %}">
                <span>å…¬ä¼—å·è®¾ç½®</span>
            </a>
        </div>
    </div>

    <!-- å³ä¾§å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
        <div class="content-header">
            <h2>{{ page_title|default:"å›¾æ–‡æ¦‚è§ˆ" }}</h2>
        </div>
        <div class="content-body">
            {% if active_menu == 'wechat_overview' %}
                <!-- ç”µå½±åˆé›†æ¦‚è§ˆå†…å®¹ -->
                <div class="stats-cards">
                    <div class="stat-card">
                        <h3>ç”µå½±æ€»æ•°</h3>
                        <p class="stat-number">{{ movie_stats.total|default:"0" }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>æœ€æ–°æ›´æ–°</h3>
                        <p class="stat-number">{{ movie_stats.latest|default:"0" }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>çƒ­é—¨ç”µå½±</h3>
                        <p class="stat-number">{{ movie_stats.popular|default:"0" }}</p>
                    </div>
                </div>
                
                <!-- ç”µå½±åˆé›†æ“ä½œ -->
                <div class="table-container">
                    <div class="table-actions">
                        <button class="btn btn-primary" onclick="createNewMovie()">æ–°å¢ç”µå½±</button>
                        <button class="btn btn-primary" onclick="syncMovies()">åŒæ­¥ç”µå½±ä¿¡æ¯</button>
                        <button class="btn btn-primary" onclick="openSettingsModal()">è®¾ç½®</button>
                        {% csrf_token %}
                        <div class="search-box">
                            <input type="text" placeholder="æœç´¢ç”µå½±...">
                        </div>
                    </div>
                    
                    <!-- ç”µå½±åˆ—è¡¨ -->
                    <div class="collection-grid">
                        {% for movie in movie_list|default:'' %}
                        <div class="collection-card" data-id="{{ movie.id|default:forloop.counter }}">
                            <div class="collection-cover">
                                <img src="{{ movie.cover_image|default:'https://via.placeholder.com/300x200' }}" alt="{{ movie.title|default:'ç”µå½±æ ‡é¢˜' }}">
                                <div class="collection-overlay">
                                    <span class="article-count">è¯„åˆ†: {{ movie.rating|default:'8.0' }}</span>
                                </div>
                            </div>
                            <div class="collection-info">
                                <h3>{{ movie.title|default:'ç”µå½±æ ‡é¢˜ç¤ºä¾‹' }}</h3>
                                <p>{{ movie.description|default:'è¿™æ˜¯ä¸€éƒ¨ç¤ºä¾‹ç”µå½±ï¼Œè¿™é‡Œæ˜¯ç®€çŸ­çš„æè¿°ä¿¡æ¯ã€‚' }}</p>
                                <div class="collection-stats">
                                    <span>{{ movie.year|default:'2023' }}</span>
                                    <span>{{ movie.genre|default:'å‰§æƒ…' }}</span>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="empty-state">
                            <p>æš‚æ— ç”µå½±æ•°æ®ï¼Œç‚¹å‡»"æ–°å¢ç”µå½±"å¼€å§‹æ·»åŠ </p>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        {% if movie_list.has_previous %}
                            <a href="?page=1" class="page-link first-page">é¦–é¡µ</a>
                            <a href="?page={{ movie_list.previous_page_number }}" class="page-link">ä¸Šä¸€é¡µ</a>
                        {% endif %}

                        <div class="current-page">
                            ç¬¬ {{ movie_list.number|default:'1' }} é¡µ / å…± {{ movie_list.paginator.num_pages|default:'1' }} é¡µ
                        </div>

                        {% if movie_list.has_next %}
                            <a href="?page={{ movie_list.next_page_number }}" class="page-link">ä¸‹ä¸€é¡µ</a>
                            <a href="?page={{ movie_list.paginator.num_pages }}" class="page-link last-page">æœ«é¡µ</a>
                        {% endif %}
                    </div>
                </div>
                
            {% elif active_menu == 'article_manage' %}
                <!-- å‰§é›†åˆé›†ç®¡ç†è¡¨æ ¼ -->
                <div class="table-container">
                    <div class="table-actions">
                        <button class="btn btn-primary" onclick="createArticle()">æ–°å»ºå›¾æ–‡</button>
                        <button class="btn btn-primary" onclick="batchPublish()">æ‰¹é‡å‘å¸ƒ</button>
                        <button class="btn btn-primary" onclick="openSettingsModal()">è®¾ç½®</button>
                        {% csrf_token %}
                        <div class="search-box">
                            <input type="text" placeholder="æœç´¢å›¾æ–‡...">
                        </div>
                    </div>
                    
                    <!-- æ–‡ç« åˆ—è¡¨ -->
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æ ‡é¢˜</th>
                                <th>ä½œè€…</th>
                                <th>å‘å¸ƒæ—¥æœŸ</th>
                                <th>é˜…è¯»é‡</th>
                                <th>ç‚¹èµæ•°</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for article in articles %}
                            <tr>
                                <td>{{ article.title }}</td>
                                <td>{{ article.author }}</td>
                                <td>{{ article.publish_date }}</td>
                                <td>{{ article.read_count }}</td>
                                <td>{{ article.like_count }}</td>
                                <td>{{ article.status }}</td>
                                <td>
                                    <button class="btn-icon" title="ç¼–è¾‘" onclick="editArticle('{{ article.id }}')">âœï¸</button>
                                    <button class="btn-icon" title="åˆ é™¤" onclick="deleteArticle('{{ article.id }}')">ğŸ—‘ï¸</button>
                                    <button class="btn-icon" title="é¢„è§ˆ" onclick="previewArticle('{{ article.id }}')">ğŸ‘ï¸</button>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7" class="empty-message">æš‚æ— æ–‡ç« æ•°æ®</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    
                    <!-- åˆ†é¡µ -->
                    <div class="pagination">
                        {% if articles.has_previous %}
                            <a href="?page=1" class="page-link first-page">é¦–é¡µ</a>
                            <a href="?page={{ articles.previous_page_number }}" class="page-link">ä¸Šä¸€é¡µ</a>
                        {% endif %}

                        <div class="current-page">
                            ç¬¬ {{ articles.number|default:'1' }} é¡µ / å…± {{ articles.paginator.num_pages|default:'1' }} é¡µ
                        </div>

                        {% if articles.has_next %}
                            <a href="?page={{ articles.next_page_number }}" class="page-link">ä¸‹ä¸€é¡µ</a>
                            <a href="?page={{ articles.paginator.num_pages }}" class="page-link last-page">æœ«é¡µ</a>
                        {% endif %}
                    </div>
                </div>
            {% elif active_menu == 'media_library' %}
                <!-- ç´ æåº“å†…å®¹ -->
                <div class="table-container">
                    <div class="table-actions">
                        <button class="btn btn-primary" onclick="uploadMedia()">ä¸Šä¼ ç´ æ</button>
                        <button class="btn btn-primary" onclick="createFolder()">æ–°å»ºæ–‡ä»¶å¤¹</button>
                        <button class="btn btn-primary" onclick="openSettingsModal()">è®¾ç½®</button>
                        {% csrf_token %}
                        <div class="search-box">
                            <input type="text" placeholder="æœç´¢ç´ æ...">
                        </div>
                    </div>
                    
                    <!-- ç´ æç½‘æ ¼ -->
                    <div class="media-grid">
                        <p>ç´ æåº“å†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
            {% elif active_menu == 'data_analysis' %}
                <!-- æ•°æ®åˆ†æå†…å®¹ -->
                <div class="stats-container">
                    <div class="chart-section">
                        <h3>æ•°æ®ç»Ÿè®¡</h3>
                        <p>æ•°æ®åˆ†æå›¾è¡¨å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- æ·»åŠ è®¾ç½®æ¨¡æ€æ¡† -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalLabel">å…¬ä¼—å·è®¾ç½®</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="wechatSettingsForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="appid" class="form-label">AppID</label>
                        <input type="text" class="form-control" id="appid" name="appid">
                    </div>
                    <div class="mb-3">
                        <label for="appsecret" class="form-label">AppSecret</label>
                        <input type="password" class="form-control" id="appsecret" name="appsecret">
                    </div>
                    <div class="mb-3">
                        <label for="token" class="form-label">Token</label>
                        <input type="text" class="form-control" id="token" name="token">
                    </div>
                    <div class="mb-3 form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="auto_sync" name="auto_sync">
                        <label class="form-check-label" for="auto_sync">å¯ç”¨è‡ªåŠ¨åŒæ­¥</label>
                    </div>
                    <div class="mb-3">
                        <label for="sync_interval" class="form-label">åŒæ­¥é—´éš”ï¼ˆå°æ—¶ï¼‰</label>
                        <input type="number" class="form-control" id="sync_interval" name="sync_interval" min="1" max="24">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                <button type="button" class="btn btn-primary" onclick="saveWechatSettings()">ä¿å­˜è®¾ç½®</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="{% static 'js/wechat.js' %}"></script>
{% endblock %} 